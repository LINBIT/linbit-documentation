# Language cn translations for PACKAGE package
# Copyright (C) 2023 Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# Automatically generated, 2023.
#
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: documentation@linbit.com\n"
"POT-Creation-Date: 2023-05-19 18:19+0000\n"
"PO-Revision-Date: 2023-05-18 09:56-0400\n"
"Last-Translator: Automatically generated\n"
"Language-Team: none\n"
"Language: cn\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:2 UG9/en/linstor-gateway.adoc:70
#, fuzzy, no-wrap
msgid "DRBD Reactor"
msgstr "DRBD特征"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:8
msgid ""
"indexterm2:[DRBD Reactor] is a daemon that monitors DRBD events and reacts "
"to them.  DRBD Reactor has various potential uses, from monitoring DRBD "
"resources and metrics, to creating failover clusters to providing highly "
"available services that you would usually need to configure using complex "
"cluster managers."
msgstr ""

#. type: Title ===
#: UG9/en/drbd-reactor.adoc:10
#, fuzzy, no-wrap
#| msgid "Controlling DRBD Proxy"
msgid "Installing DRBD Reactor"
msgstr "控制DRBD代理"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:15
msgid ""
"DRBD Reactor can be installed from source files found within https://github."
"com/LINBIT/drbd-reactor[the project's GitHub repository].  See the "
"instructions there for details and any prerequisites."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:19
msgid ""
"Alternatively, LINBIT customers can install DRBD Reactor from prebuilt "
"packages, available from LINBIT's `drbd-9` packages repository."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:23
msgid ""
"Once installed, you can verify DRBD Reactor's version number by using the "
"`drbd-reactor --version` command."
msgstr ""

#. type: Title ===
#: UG9/en/drbd-reactor.adoc:25
#, no-wrap
msgid "DRBD Reactor's Components"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:29
msgid ""
"Because DRBD Reactor has many different uses, it was split into two "
"components: a core component and a plug-in component."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:31
#, fuzzy, no-wrap
#| msgid "DRBD Features"
msgid "DRBD Reactor Core"
msgstr "DRBD特征"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:35
msgid ""
"DRBD Reactor’s core component is responsible for collecting DRBD events, "
"preparing them, and sending them to the DRBD Reactor plug-ins."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:40
msgid ""
"The core can be reloaded with an all new or an additional, updated "
"configuration. It can stop plug-in instances no longer required and start "
"new plug-in threads without losing DRBD events.  Last but not least, the "
"core has to ensure that plug-ins receive an initial and complete DRBD state."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:42
#, fuzzy, no-wrap
#| msgid "DRBD clients"
msgid "DRBD Reactor Plug-ins"
msgstr "DRBD客户端"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:47
msgid ""
"Plug-ins provide DRBD Reactor with its functionality and there are different "
"plug-ins for different uses. A plug-in receives messages from the core "
"component and acts upon DRBD resources based on the message content and "
"according to the plug-in’s type and configuration."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:51
msgid ""
"Plug-ins can be instantiated multiple times, so there can be multiple "
"instances of every plug-in type. So, for example, numerous plug-in instances "
"could provide high-availability in a cluster, one per DRBD resource."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:53
#, no-wrap
msgid "The Promoter Plug-in"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:61
msgid ""
"The promoter plug-in is arguably DRBD Reactor's most important and useful "
"feature. You can use it to create failover clusters hosting highly available "
"services more easily than using other more complex cluster resource managers "
"(CRMs). If you want to get started quickly, you can finish reading this "
"section, then skip to <<s-drbd-reactor-promoter-plug-in-configuring>>. You "
"can then try the instructions in the <<s-drbd-reactor-creating-a-ha-file-"
"system-mount>> section for an example exercise."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:67
msgid ""
"The promoter plug-in monitors events on DRBD resources and executes systemd "
"units. This plug-in allows DRBD Reactor to provide failover functionality to "
"a cluster to create high-availability deployments. You can use DRBD Reactor "
"and its promoter plug-in as a replacement for other CRMs, such as Pacemaker, "
"in many scenarios where its lightness and its configuration simplicity offer "
"advantages."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:72
msgid ""
"For example, you can use the promoter plug-in to configure fully automatic "
"recovery of isolated primary nodes. Furthermore, there is no need for a "
"separate communication layer (such as Corosync), because DRBD and DRBD "
"Reactor (used as the CRM) will always agree on the quorum status of nodes."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:77
msgid ""
"A disadvantage to the promoter plug-in when compared to a CRM such as "
"Pacemaker is that it is not possible to create order constraints that are "
"independent of colocations. For example, if a web service and a database run "
"on different nodes, Pacemaker can constrain the web service to start after "
"the database. DRBD Reactor and its promoter plug-in cannot."
msgstr ""

#. type: Title =====
#: UG9/en/drbd-reactor.adoc:79
#, no-wrap
msgid "How the Promoter Plug-in Works"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:84
msgid ""
"The promoter plug-in’s main function is that if a DRBD device can be "
"promoted, promote it to _Primary_ and start a set of user-defined services. "
"This could be a series of services, such as:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:86
#, fuzzy
#| msgid "the size of the DRBD device,"
msgid "Promote the DRBD device."
msgstr "DRBD设备的大小，"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:87
msgid "Mount the device to a mount point."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:88
msgid "Start a database that uses a database located at the mount point."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:91
msgid ""
"If a resource loses quorum, DRBD Reactor stops these services so that "
"another node that still has quorum (or the node that lost quorum when it has "
"quorum again) can start the services."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:95
msgid ""
"The promoter plug-in also supports Open Cluster Framework (OCF) resource "
"agents and failure actions such as rebooting a node if a resource fails to "
"demote, so that the resource can promote on another node."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:97
#, no-wrap
msgid "The User Mode Helper (UMH) Plug-in"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:102
msgid ""
"Using this plug-in and its domain specific language (DSL), you can execute a "
"script if an event you define occurs. For example, you can run a script that "
"sends a Slack message whenever a DRBD resource loses connection."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:107
msgid ""
"This functionality has existed before in DRBD with “user-defined helper "
"scripts” in “kernel space”. However, DRBD Reactor, including the UMH plug-"
"in, can be executed in “user space”. This allows for easier container "
"deployments and use with “read-only” host file systems such as those found "
"within container distributions."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:112
msgid ""
"Using UMH plug-ins also provides a benefit beyond what was previously "
"possible using user defined helper scripts: Now you can define your own "
"rules for all the events that are possible for a DRBD resource. You are no "
"longer limited to only the few events that there are event handlers in the "
"kernel for."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:114
msgid "UMH plug-in scripts can be of two types:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:117
#, no-wrap
msgid ""
"*User-defined filters*. These are “one-shot” UMH scripts where an event happens that triggers\n"
"the script.\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:123
#, no-wrap
msgid ""
"*Kernel called helper replacements*. This type of script is currently under development. These\n"
"are UMH scripts that require communication to and from the kernel. An event triggers the\n"
"script but an action within the script requires the kernel to communicate back to the script\n"
"so that the script can take a next action, based on the failure or success of the kernel’s\n"
"action. An example of such a script would be a `before-resync-target` activated script.\n"
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:125
#, no-wrap
msgid "The Prometheus Monitoring Plug-in"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:134
msgid ""
"This plug-in provides a https://prometheus.io/[Prometheus] compatible "
"endpoint that exposes various DRBD metrics, including out-of-sync bytes, "
"resource roles (for example, _Primary_), and connection states (for example, "
"_Connected_). This information can then be used in every monitoring solution "
"that supports Prometheus endpoints. The full set of metrics and an example "
"Grafana dashboard are available at the https://github.com/LINBIT/drbd-"
"reactor/blob/master/doc/prometheus.md[DRBD Reactor GitHub repository]."
msgstr ""

#. type: Title ===
#: UG9/en/drbd-reactor.adoc:136
#, fuzzy, no-wrap
#| msgid "Configuring DRBD"
msgid "Configuring DRBD Reactor"
msgstr "配置DRBD"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:146
msgid ""
"Before you can run DRBD Reactor, you must configure it. Global "
"configurations are made within a main TOML configuration file, which should "
"be created here: `/etc/drbd-reactor.toml`. The file has to be a valid TOML "
"(https://toml.io) file. Plug-in configurations should be made within snippet "
"files that can be placed into the default DRBD Reactor snippets directory, `/"
"etc/drbd-reactor.d`, or into another directory if specified in the main "
"configuration file. An https://github.com/LINBIT/drbd-reactor/blob/master/"
"example/drbd-reactor.toml[example configuration file] can be found in the "
"`example` directory of the DRBD Reactor GitHub repository."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:150
msgid ""
"For documentation purposes only, the example configuration file mentioned "
"above contains example plug-in configurations. However, for deployment, plug-"
"in configurations should always be made within snippet files."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:152
#, fuzzy, no-wrap
#| msgid "Configuring DRBD"
msgid "Configuring DRBD Reactor's Core"
msgstr "配置DRBD"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:155
msgid ""
"DRBD Reactor’s core configuration file consists of global settings and log "
"level settings."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:160
msgid ""
"Global settings include specifying a snippets directory, specifying a "
"statistics update polling time period, as well as specifying a path to a log "
"file. You can also set the log level within the configuration file to one "
"of: trace, debug, info, warn, error, off. “Info” is the default log level."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:162
msgid "See the `drbd-reactor.toml` man page for the syntax of these settings."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:164
#, fuzzy, no-wrap
#| msgid "Configuring DRBD"
msgid "Configuring DRBD Reactor Plug-ins"
msgstr "配置DRBD"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:170
msgid ""
"You configure DRBD Reactor plug-ins by editing TOML formatted snippet files. "
"Every plug-in can specify an ID (`id`) in its configuration section. On a "
"DRBD Reactor daemon reload, started plug-ins that are still present in the "
"new configuration keep running. Plug-ins without an ID get stopped and "
"restarted if still present in the new configuration."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:172
msgid ""
"For plug-ins without an ID, every DRBD Reactor service reload is a restart."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:174
#, fuzzy, no-wrap
#| msgid "Configuring the Nodes"
msgid "Configuring the Promoter Plug-in"
msgstr "配置节点"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:178
msgid ""
"You will typically have one snippet file for each DRBD resource that you "
"want DRBD Reactor and the promoter plug-in to watch and manage."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:180
msgid "Here is an example promoter plug-in configuration snippet:"
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:190
#, no-wrap
msgid ""
"[[promoter]]\n"
"[promoter.resources.my_drbd_resource] <1>\n"
"dependencies-as = \"Requires\" <2>\n"
"target-as = \"Requires\" <3>\n"
"start = [\"path-to-my-file-system-mount.mount\", \"foo.service\"] <4>\n"
"on-drbd-demote-failure = \"reboot\" <5>\n"
"secondary-force = true <6>\n"
"preferred-nodes = [\"nodeA\", \"nodeB\"] <7>\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:194
msgid ""
"\"my_drbd_resource\" specifies the name of the DRBD resource that DRBD "
"Reactor and the promoter plug-in should watch and manage."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:196
msgid ""
"Specifies the systemd dependency type to generate inter-service dependencies "
"as."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:199
msgid ""
"Specifies the systemd dependency type to generate service dependencies in "
"the final target unit."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:202
msgid ""
"`start` specifies what should be started when the watched DRBD resource is "
"promotable. In this example, the promoter plug-in would start a file system "
"mount unit and a service unit."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:208
msgid ""
"Specifies the action to take if a DRBD resource fails to demote, for "
"example, after a loss of quorum event. In such a case, an action should be "
"taken on the node that fails to demote that will trigger some \"self-"
"fencing\" of the node and cause another node to promote. Actions can be one "
"of: reboot, reboot-force, reboot-immediate, poweroff, poweroff-force, "
"poweroff-immediate, exit, exit-force."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:215
msgid ""
"If a node loses quorum, DRBD Reactor will try to demote the node to a "
"secondary role. If the resource was configured to suspend I/O operations "
"upon loss of quorum, this setting specifies whether or not to demote the "
"node to a secondary role using `drbdadm`'s force secondary feature. See the "
"<<s-force-secondary>> section of the DRBD User's Guide for more details. "
"\"true\" is the default option if this setting is not specified. It is "
"specified here for illustrative purposes."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:217
#, fuzzy
#| msgid ""
#| "Pacemaker constraints ensuring that resources are started on the correct "
#| "nodes, and in the correct order."
msgid ""
"If set, resources are started on the preferred nodes, in the specified "
"order, if possible."
msgstr "Pacemaker约束确保资源以正确的顺序在正确的节点上启动。"

#. type: Title =====
#: UG9/en/drbd-reactor.adoc:219
#, no-wrap
msgid "Specifying a Promoter Start List Service String Spanning Multiple Lines"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:227
msgid ""
"For formatting or readability reasons, it is possible to split a long "
"service string across multiple lines within a promoter plug-in snippet "
"file's start list of services. You can do this by using https://toml.io/en/"
"v1.0.0#string[TOML syntax for multi-line basic strings]. In the following "
"example, the first and third service strings in a promoter plug-in's start "
"list are split across multiple lines. A backslash (\\) at the end of a line "
"within a multi-line basic string ensures that a newline character is not "
"inserted between lines within the string."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:239
#, no-wrap
msgid ""
"[...]\n"
"start = [\n"
"\"\"\"\n"
"ocf:heartbeat:Filesystem fs_mysql device=/dev/drbd1001 \\\n"
"directory=/var/lib/mysql fstype=ext4 run_fsck=no\"\"\",\n"
"\"mariadb.service\",\n"
"\"\"\"ocf:heartbeat:IPaddr2 db_virtip ip=192.168.222.65 \\\n"
"cidr_netmask=24 iflabel=virtualip\"\"\"\n"
"]\n"
"[...]\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:243
msgid ""
"You can also use this technique to split up long strings within other plug-"
"in snippet files."
msgstr ""

#. type: Title =====
#: UG9/en/drbd-reactor.adoc:245
#, fuzzy, no-wrap
#| msgid "Configuring your resource"
msgid "Configuring Resource Freezing"
msgstr "配置资源"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:251
msgid ""
"Starting with DRBD Reactor version 0.9.0, you can configure the promoter "
"plug-in to \"freeze\" a resource that DRBD Reactor is controlling, rather "
"than stopping it when a currently active node loses quorum. DRBD Reactor can "
"then \"thaw\" the resource when the node regains quorum and becomes active, "
"rather than having to restart the resource if it was stopped."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:262
msgid ""
"While in most cases the default stop and start behavior will be preferred, "
"the freeze and thaw configuration could be useful for a resource that takes "
"a long time to start, for example, a resource that includes services such as "
"a large database. If a _Primary_ node loses quorum in such a cluster, and "
"the remaining nodes are unable to form a partition with quorum, freezing the "
"resource could be useful, especially if the _Primary_ node's loss of quorum "
"was momentary, for example due to a brief network issue. When the formerly "
"_Primary_ node with a frozen resource reconnects with its peer nodes, the "
"node would again become _Primary_ and DRBD Reactor would thaw the resource. "
"The result of this behavior could be that the resource is again available in "
"seconds, rather than minutes, because the resource did not have to start "
"from a stopped state, it only had to resume from a frozen one."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:265
msgid "====== Requirements:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:267
msgid ""
"Before configuring the promoter plug-in's freeze feature for a resource, you "
"will need:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:273
msgid ""
"A system that uses https://www.kernel.org/doc/html/latest/admin-guide/cgroup-"
"v2.html[cgroup v2], implementing unified cgroups. You can verify this by the "
"presence of `/sys/fs/cgroup/cgroup.controllers` on your system. If this is "
"not present, and your kernel supports it, you should be able to add the "
"kernel command line argument `systemd.unified_cgroup_hierarchy=1` to enable "
"this feature."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:275
msgid ""
"This should only be relevant for RHEL 8, Ubuntu 20.04, and earlier versions."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:277
#, fuzzy
#| msgid "The TCP port for DRBD to use for the resource's connection"
msgid "The following DRBD options configured for the resource:"
msgstr "用于资源连接的DRBD的TCP端口"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:278
msgid "`on-no-quorum` set to `suspend-io`;"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:279
msgid "`on-no-data-accessible` set to `suspend-io`;"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:280
msgid "`on-suspended-primary` set to `force-secondary`;"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:281
msgid "`rr-conflict` (`net` option) set to `retry-connect`."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:288
msgid ""
"A resource that can \"tolerate\" freezing and thawing. You can test how your "
"resource (and any applications that rely on the resource) respond to "
"freezing and thawing by using the `systemctl freeze <systemd_unit>`, and the "
"`systemctl thaw <systemd_unit>` commands. Here you specify the systemd unit "
"or units that correspond to the start list of services within the promoter "
"plug-in's configuration. You can use these commands to test how your "
"applications behave, after services that they depend on are frozen and "
"thawed."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:291
msgid ""
"If you are unsure whether your resource and applications will tolerate "
"freezing, then it is safer to keep the default stop and start behavior."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:294
msgid ""
"To configure resource freezing, add the following line to your DRBD Reactor "
"resource's promoter plug-in snippet file:"
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:297
#, no-wrap
msgid "on-quorum-loss = \"freeze\"\n"
msgstr ""

#. type: Title =====
#: UG9/en/drbd-reactor.adoc:300
#, no-wrap
msgid "Using OCF Resource Agents with the Promoter Plug-in"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:304
msgid ""
"You can also configure the promoter plug-in to use OCF resource agents in "
"the `start` list of services."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:309 UG9/en/drbd-reactor.adoc:497
msgid ""
"If you have a LINBIT customer or evaluation account, you can install the "
"`resource-agents` package available in LINBIT's `drbd-9` package repository "
"to install a suite of open source resource agent scripts, including the "
"\"Filesystem\" OCF resource agent."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:315
msgid ""
"The syntax for specifying an OCF resource agent as a service within a "
"`start` list is `ocf:$vendor:$agent instance-id [key=value key=value ...]`. "
"Here, `instance-id` is user-defined and `key=value` pairs, if specified, are "
"passed as environment variables to the created systemd unit file. For "
"example:"
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:321
#, no-wrap
msgid ""
"[[promoter]]\n"
"[...]\n"
"start = [\"ocf:heartbeat:IPaddr2 ip_mysql ip=10.43.7.223 cidr_netmask=16\"]\n"
"[...]\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:325
msgid ""
"The promoter plug-in expects OCF resource agents in the `/usr/lib/ocf/"
"resource.d/` directory."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:327
#, no-wrap
msgid "Configuring the User Mode Helper (UMH) Plug-in"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:330
msgid "Configuration for this plug-in consists of:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:332
msgid "Rule type"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:333
msgid "Command or script to execute"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:334
msgid "User-defined environment variables (optional)"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:335
msgid "Filters based on DRBD resource name, event type, or state changes"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:338
msgid ""
"There are four different DRBD types a rule can be defined for: `resource`, "
"`device`, `peerdevice`, or `connection`."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:342
msgid ""
"For each rule type, you can configure a command or script to execute using "
"`sh -c` as well as any user-defined environment variables. User-defined "
"environment variables are in addition to the commonly set ones:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:344
msgid "HOME “/”"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:345
msgid "TERM “Linux”"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:346
msgid "PATH “/sbin:/usr/sbin:/bin:/usr/bin”"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:349
msgid ""
"You can also filter UMH rule types by DRBD resource name or event type "
"(exists, create, destroy, or change)."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:356
msgid ""
"Finally, you can filter the plug-in’s action based on DRBD state changes. "
"Filters should be based upon both the old and the new (current) DRBD state, "
"that are reported to the plug-in, because you want the plug-in to react to "
"changes. This is only possible if two states, old and new, are filtered for, "
"otherwise the plug-in might trigger randomly. For example, if you only "
"specified a new (current) DRBD role as a DRBD state to filter for, the plug-"
"in might trigger even when the new role is the same as the old DRBD role."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:358
#, fuzzy
#| msgid "An example CPU mask configuration for a resource may look like this:"
msgid ""
"Here is an example UMH plug-in configuration snippet for a `resource` rule:"
msgstr "资源的CPU掩码配置示例如下："

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:367
#, no-wrap
msgid ""
"[[umh]]\n"
"[[umh.resource]]\n"
"command = \"slack.sh $DRBD_RES_NAME on $(uname -n) from $DRBD_OLD_ROLE to $DRBD_NEW_ROLE\"\n"
"event-type = \"Change\"\n"
"resource-name = \"my-resource\"\n"
"old.role = { operator = \"NotEquals\", value = \"Primary\" }\n"
"new.role = \"Primary\"\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:371
msgid ""
"This example UMH plug-in configuration is based on change event messages "
"received from DRBD Reactor’s daemon for the DRBD resource specified by the "
"`resource-name` value `my-resource`."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:380
msgid ""
"If the resource’s old role was not _Primary_ and its new (current) role is "
"_Primary_, then a script named `slack.sh` runs with the arguments that "
"follow. As the full path is not specified, the script needs to reside within "
"the commonly set `PATH` environment variable (`/sbin:/usr/sbin:/bin:/usr/"
"bin`) of the host machine (or container if run that way).  Presumably, the "
"script sends a message to a Slack channel informing of the resource role "
"change.  Variables specified in the command string value are substituted for "
"based on specified values elsewhere in the plug-in's configuration, for "
"example, the value specified by `resource-name` will be substituted for "
"`$DRBD_RES_NAME` when the command runs."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:385
msgid ""
"The example configuration above uses the specified operator \"NotEquals\" to "
"evaluate whether or not the `old.role` value of \"Primary\" was true. If you "
"do not specify an operator, then the default operator is \"Equals\", as in "
"the `new.role = \"Primary\"` filter in the example configuration."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:390
msgid ""
"There are more rules, fields, filter types, and variables that you can "
"specify in your UMH plug-in configurations. See the https://github.com/"
"LINBIT/drbd-reactor/blob/master/doc/umh.md[UMH documentation page] in the "
"DRBD Reactor GitHub repository for more details, explanations, examples, and "
"caveats."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:392
#, fuzzy, no-wrap
#| msgid "Configuring the Nodes"
msgid "Configuring the Prometheus Plug-in"
msgstr "配置节点"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:398
msgid ""
"This plug-in provides a Prometheus compatible HTTP endpoint serving DRBD "
"monitoring metrics, such as the DRBD connection state, whether or not the "
"DRBD device has quorum, number of bytes out of sync, indication of TCP send "
"buffer congestion, and many more. The `drbd-reactor.prometheus` man page has "
"a full list of metrics and more details."
msgstr ""

#. type: Title ===
#: UG9/en/drbd-reactor.adoc:400
#, no-wrap
msgid "Using the DRBD Reactor CLI Utility"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:404
msgid ""
"You can use the DRBD Reactor CLI utility, `drbd-reactorctl`, to control the "
"DRBD Reactor daemon and its plug-ins."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:408
msgid ""
"This utility only operates on plug-in snippets. Any existing plug-in "
"configurations in the main configuration file (not advised nor supported) "
"should be moved to snippet files within the snippets directory."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:410
msgid "With the `drbd-reactorctl` utility, you can:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:413
msgid ""
"Get the status of the DRBD Reactor daemon and enabled plug-ins, by using the "
"`drbd-reactorctl status` command."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:416
msgid ""
"Edit an existing or create a new plug-in configuration, by using the `drbd-"
"reactorctl edit -t <plug-in_type> <plug-in_file>` command."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:419
msgid ""
"Display the TOML configuration of a given plug-in, by using the `drbd-"
"reactorctl cat <plug-in_file>` command."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:422
msgid ""
"Enable or disable a plug-in, by using the `drbd-reactorctl enable|disable "
"<plug-in_file>` command."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:425
msgid ""
"Evict a promoter plug-in resource from the node, by using the `drbd-"
"reactorctl evict <plug-in_file>` command."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:429
msgid ""
"Restart specified plug-ins (or the DRBD Reactor daemon, if no plug-ins "
"specified) by using the `drbd-reactorctl restart <plug-in_file>` command. "
"Remove an existing plug-in and restart the daemon, by using the `drbd-"
"reactorctl rm <plug-in_file>` command."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:432
msgid ""
"List the activated plug-ins, or optionally list disabled plug-ins, by using "
"the `drbd-reactorctl ls [--disabled]` command."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:435
msgid ""
"For greater control of some of the above actions, there are additional "
"options available. The `drbd-reactorctl` man page has more details and "
"syntax information."
msgstr ""

#. type: Title ====
#: UG9/en/drbd-reactor.adoc:437
#, no-wrap
msgid "Pacemaker CRM Shell Commands and Their DRBD Reactor Client Equivalents"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:441
msgid ""
"The following table shows some common CRM tasks and the corresponding "
"Pacemaker CRM shell and the equivalent DRBD Reactor client commands."
msgstr ""

#. type: Table
#: UG9/en/drbd-reactor.adoc:457
#, no-wrap
msgid ""
"|CRM task|Pacemaker CRM shell command|DRBD Reactor client command\n"
"\n"
"|Get status\n"
"|`crm_mon`\n"
"|`drbd-reactorctl status`\n"
"\n"
"|Migrate away\n"
"|`crm resource migrate`\n"
"|`drbd-reactorctl evict`\n"
"\n"
"|Unmigrate\n"
"|`crm resource unmigrate`\n"
"|Unnecessary\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:468
msgid ""
"A DRBD Reactor client command that is equivalent to `crm resource unmigrate` "
"is unnecessary because DRBD Reactor's promoter plug-in evicts a DRBD "
"resource in the moment, but it does not prevent the resource from failing "
"back to the node it was evicted from later, should the situation arise. In "
"contrast, the CRM shell `migrate` command inserts a permanent constraint "
"into the cluster information base (CIB) that prevents the resource from "
"running on the node the command is run on. The CRM shell `unmigrate` command "
"is a manual intervention that removes the constraint and allows the resource "
"to fail back to the node the command is run on. A forgotten `unmigrate` "
"command can have dire consequences the next time the node might be needed to "
"host the resource during an HA event."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:474
msgid ""
"If you need to prevent failback to a particular node, you can evict it by "
"using the DRBD Reactor client with the `evict --keep-masked` command and "
"flag. This prevents failback, until the node reboots and the flag gets "
"removed. You can remove the flag sooner than a reboot would, by using the "
"`drbd-reactorctl evict --unmask` command. This command would be the "
"equivalent to CRM shell's `unmigrate` command."
msgstr ""

#. type: Title ===
#: UG9/en/drbd-reactor.adoc:476
#, no-wrap
msgid "Using DRBD Reactor’s Promoter Plug-in to Create a Highly Available File System Mount"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:480
msgid ""
"In this example, you will use DRBD Reactor and the promoter plug-in to "
"create a highly available file system mount within a cluster."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:482 UG9/en/drbd-reactor.adoc:621
msgid "Prerequisites:"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:484
msgid "A directory `/mnt/test` created on all of your cluster nodes"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:487
msgid ""
"A DRBD configured resource named _ha-mount_ that is backed by a DRBD device "
"on all nodes. The configuration examples that follow use `/dev/drbd1000`."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:492
msgid ""
"The Cluster Labs \"Filesystem\" OCF resource agent, available through "
"https://github.com/ClusterLabs/resource-agents/blob/main/heartbeat/"
"Filesystem[Cluster Lab's `resource-agents` GitHub] repository, should be "
"present in the `/usr/lib/ocf/resource.d/heartbeat` directory"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:501
msgid ""
"The DRBD resource, _ha-mount_, should have the following settings configured "
"in its DRBD resource configuration file:"
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:513
#, fuzzy, no-wrap
#| msgid ""
#| "resource test {\n"
#| "  options {\n"
#| "    cpu-mask ff;\n"
#| "    on-no-data-accessible suspend-io;\n"
#| "  }\n"
#| "  ...\n"
#| "}\n"
msgid ""
"resource ha-mount {\n"
"  options {\n"
"    auto-promote no;\n"
"    quorum majority;\n"
"    on-no-quorum suspend-io;\n"
"    on-no-data-accessible suspend-io;\n"
"    [...]\n"
"  }\n"
"[...]\n"
"}\n"
msgstr ""
"resource test {\n"
"  options {\n"
"    cpu-mask ff;\n"
"    on-no-data-accessible suspend-io;\n"
"  }\n"
"  ...\n"
"}\n"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:516
msgid "First, make one of your nodes _Primary_ for the _ha-mount_ resource."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:519
#, fuzzy, no-wrap
#| msgid "# drbdadm primary r0\n"
msgid "# drbdadm primary ha-mount\n"
msgstr "# drbdadm primary r0\n"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:523
msgid ""
"Then create a file system on the DRBD backed device. The ext4 file system is "
"used in this example."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:526
#, fuzzy, no-wrap
#| msgid "# pvcreate /dev/drbdX\n"
msgid "# mkfs.ext4 /dev/drbd1000\n"
msgstr "# pvcreate /dev/drbdX\n"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:530
msgid ""
"Make the node _Secondary_ because after further configurations, DRBD Reactor "
"and the Promoter plug-in will control promoting nodes."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:533
#, fuzzy, no-wrap
#| msgid "# drbdadm primary r0\n"
msgid "# drbdadm secondary ha-mount\n"
msgstr "# drbdadm primary r0\n"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:536
msgid ""
"On all nodes that should be able to mount the DRBD backed device, create a "
"systemd unit file:"
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:541
#, no-wrap
msgid ""
"# cat << EOF > /etc/systemd/system/mnt-test.mount\n"
"[Unit]\n"
"Description=Mount /dev/drbd1000 to /mnt/test\n"
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:547
#, no-wrap
msgid ""
"[Mount]\n"
"What=/dev/drbd1000\n"
"Where=/mnt/test\n"
"Type=ext4\n"
"EOF\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:553
msgid ""
"The systemd unit file name must match the mount location value given by the "
"“Where=” directive, using systemd escape logic. In the example above, `mnt-"
"test.mount` matches the mount location given by `Where=/mnt/test`. You can "
"use the command `systemd-escape -p --suffix=mount /my/mount/point` to "
"convert your mount point to a systemd unit file name."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:556
msgid ""
"Next, on the same nodes as the previous step, create a configuration file "
"for the DRBD Reactor promoter plug-in:"
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:568
#, no-wrap
msgid ""
"# cat << EOF > /etc/drbd-reactor.d/ha-mount.toml\n"
"[[promoter]]\n"
"id = \"ha-mount\"\n"
"[promoter.resources.ha-mount]\n"
"start = [\n"
"\"\"\"ocf:heartbeat:Filesystem fs_test device=/dev/drbd1000 \\\n"
"directory=/mnt/test fstype=ext4 run_fsck=no\"\"\"\n"
"]\n"
"on-drbd-demote-failure = \"reboot\"\n"
"EOF\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:576
msgid ""
"This promoter plug-in configuration uses a start list of services that "
"specifies an OCF resource agent for the file system found at your HA mount "
"point. By using this particular resource agent, you can circumvent "
"situations where systemd might not know about certain users and processes "
"that might hold the mount point open and prevent it from unmounting. This "
"could happen if you specified a systemd mount unit for the mount point, for "
"example, `start = [\"mnt-test.mount\"]`, rather than using the OCF "
"Filesystem resource agent."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:579
msgid ""
"To apply the configuration, enable and start the DRBD Reactor service on all "
"nodes. If the DRBD Reactor service is already running, reload it instead."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:582
#, fuzzy, no-wrap
#| msgid ""
#| "# systemctl enable drbd\n"
#| "# systemctl start drbd\n"
msgid "# systemctl enable drbd-reactor.service --now\n"
msgstr ""
"# systemctl enable drbd\n"
"# systemctl start drbd\n"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:586
msgid ""
"Next, verify which cluster node is in the _Primary_ role for the _ha-mount_ "
"resource and has the backing device mounted."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:589
#, no-wrap
msgid "# drbd-reactorctl status ha-mount\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:593
msgid ""
"Test a simple failover situation on the _Primary_ node by using the DRBD "
"Reactor CLI utility to disable the _ha-mount_ configuration."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:596
#, no-wrap
msgid "# drbd-reactorctl disable --now ha-mount\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:600
msgid ""
"Run the DRBD Reactor status command again to verify that another node is now "
"in the _Primary_ role and has the file system mounted."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:602
msgid ""
"After testing failover, you can enable the configuration on the node you "
"disabled it on earlier."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:605
#, no-wrap
msgid "# drbd-reactorctl enable ha-mount\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:611
msgid ""
"As a next step, you may want to read the https://linbit.com/drbd-user-guide/"
"linstor-guide-1_0-en/#s-linstor_ha[LINSTOR User's Guide section on creating "
"a highly available LINSTOR cluster]. There, DRBD Reactor is used to manage "
"the LINSTOR Controller as a service so that it is highly available within "
"your cluster."
msgstr ""

#. type: Title ===
#: UG9/en/drbd-reactor.adoc:613
#, fuzzy, no-wrap
#| msgid "Configuring a DRBD resource as a Physical Volume"
msgid "Configuring DRBD Reactor's Prometheus Plug-in"
msgstr "将DRBD资源配置为物理卷"

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:619
msgid ""
"DRBD Reactor’s Prometheus monitoring plug-in acts as a Prometheus compatible "
"endpoint for DRBD resources and exposes various DRBD metrics. You can find a "
"list of the available metrics in https://github.com/LINBIT/drbd-reactor/blob/"
"master/doc/prometheus.md[the documentation folder] in the project’s GitHub "
"repository."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:623
msgid "Prometheus is installed with its service enabled and running."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:625
msgid "Grafana is installed with its service enabled and running."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:628
msgid ""
"To enable the Prometheus plug-in, create a simple configuration file snippet "
"on all DRBD Reactor nodes that you are monitoring."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:635
#, no-wrap
msgid ""
"# cat << EOF > /etc/drbd-reactor.d/prometheus.toml\n"
"[[prometheus]]\n"
"enums = true\n"
"address = \"0.0.0.0:9942\"\n"
"EOF\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:638
msgid "Reload the DRBD Reactor service on all nodes that you are monitoring."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:641
#, no-wrap
msgid "# systemctl reload drbd-reactor.service\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:647
msgid ""
"Add the following DRBD Reactor monitoring endpoint to your Prometheus "
"configuration file’s `scrape_configs` section. Replace “node-x” in the "
"`targets` lines below with either hostnames or IP addresses for your DRBD "
"Reactor monitoring endpoint nodes. Hostnames must be resolvable from your "
"Prometheus monitoring node."
msgstr ""

#. type: delimited block -
#: UG9/en/drbd-reactor.adoc:661
#, no-wrap
msgid ""
"  - job_name: drbd_reactor_endpoint\n"
"    static_configs:\n"
"      - targets: ['node-0:9942']\n"
"        labels:\n"
"          instance: 'node-0'\n"
"      - targets: ['node-1:9942']\n"
"        labels:\n"
"          instance: 'node-1'\n"
"      - targets: ['node-2:9942']\n"
"        labels:\n"
"          instance: 'node-2'\n"
"       [...]\n"
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:665
msgid ""
"Then, assuming it is already enabled and running, reload the Prometheus "
"service by entering `sudo systemctl reload prometheus.service`."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:669
msgid ""
"Next, you can open your Grafana server’s URL with a web browser. If the "
"Grafana server service is running on the same node as your Prometheus "
"monitoring service, the URL would look like: `http://"
"<node_IP_address_or_hostname>:3000`."
msgstr ""

#. type: Plain text
#: UG9/en/drbd-reactor.adoc:676
msgid ""
"You can then log into the Grafana server web UI, add a Prometheus data "
"source, and then add or import a Grafana dashboard that uses your Prometheus "
"data source. An example dashboard is available at the https://grafana.com/"
"grafana/dashboards/14339[Grafana Labs dashboards marketplace]. An example "
"dashboard is also available as a downloadable JSON file https://raw."
"githubusercontent.com/LINBIT/drbd-reactor/master/example/grafana-dashboard."
"json[here], at the DRBD Reactor GitHub project site."
msgstr ""
